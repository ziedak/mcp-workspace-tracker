# Development Dockerfile for MCP Workspace Tracker
# This container provides a development environment with hot-reloading

FROM node:18-alpine

# Install dependencies for development
RUN apk add --no-cache \
    bash \
    git \
    curl \
    tini \
    procps

# Create non-root user
RUN addgroup -S mcp && adduser -S mcp -G mcp

# Set working directory and create cache directory
WORKDIR /app
RUN mkdir -p /app/cache && chown -R mcp:mcp /app

# Switch to non-root user
USER mcp

# Copy package files first (for better caching)
COPY --chown=mcp:mcp package*.json ./

# Install dependencies
RUN npm install && npm cache clean --force

# Copy all project files
COPY --chown=mcp:mcp . .

# Build the TypeScript project
RUN npm run build

# Expose port for MCP server
EXPOSE 7860

# Use tini as init to handle signals properly
ENTRYPOINT ["/sbin/tini", "--"]

# Use a script to start in development mode with file watching
CMD ["npm", "run", "watch"]
